<!doctype html>

<head>
	<meta charset="UTF-8">
	<title>Financial GPS Page</title>
</head>
<body>
	<script src="api.js"></script>
	<script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js"></script>

	<div><canvas id="myChart" width="400" height="400"></canvas></div>
	<script>
		
// 		var dps =  [
// { label: "banana", y: 18 },
// { label: "orange", y: 29 },
// { label: "apple", y: 40 },
// { label: "mango", y: 34 },
// { label: "grape", y: 24 }
// ];

// var dps=[];
var data = [];
// getData().then((data)=> {
// 	var loopdata = data['items'][0]['carpark_data'];
// 	for (let i = 0; i < loopdata.length; ++i){
// 		data2.push(loopdata[i]);
// 	}
// });

// console.log(data2);

window.onload = function () {

	var ctx = document.getElementById("myChart");
var myChart = new Chart(ctx, {
  type: 'bar',
  data: {
    labels: ["2015-01", "2015-02", "2015-03", "2015-04", "2015-05", "2015-06", "2015-07", "2015-08", "2015-09", "2015-10", "2015-11", "2015-12"],
    datasets: [{
      label: '# of Tomatoes',
      data: data,
      backgroundColor: [
        'rgba(255, 99, 132, 0.2)',
        'rgba(54, 162, 235, 0.2)',
        'rgba(255, 206, 86, 0.2)',
        'rgba(75, 192, 192, 0.2)',
        'rgba(153, 102, 255, 0.2)',
        'rgba(255, 159, 64, 0.2)',
        'rgba(255, 99, 132, 0.2)',
        'rgba(54, 162, 235, 0.2)',
        'rgba(255, 206, 86, 0.2)',
        'rgba(75, 192, 192, 0.2)',
        'rgba(153, 102, 255, 0.2)',
        'rgba(255, 159, 64, 0.2)'
      ],
      borderColor: [
        'rgba(255,99,132,1)',
        'rgba(54, 162, 235, 1)',
        'rgba(255, 206, 86, 1)',
        'rgba(75, 192, 192, 1)',
        'rgba(153, 102, 255, 1)',
        'rgba(255, 159, 64, 1)',
        'rgba(255,99,132,1)',
        'rgba(54, 162, 235, 1)',
        'rgba(255, 206, 86, 1)',
        'rgba(75, 192, 192, 1)',
        'rgba(153, 102, 255, 1)',
        'rgba(255, 159, 64, 1)'
      ],
      borderWidth: 1
    }]
  },
  options: {
    responsive: false,
    scales: {
      xAxes: [{
        ticks: {
          maxRotation: 90,
          minRotation: 80
        }
      }],
      yAxes: [{
        ticks: {
          beginAtZero: true
        }
      }]
    }
  }
});
getData().then((newvar) => {
		var temp = newvar[0]['carpark_data']
		for (let i = 0; i < temp.length; ++i){
			var lots_avail = temp[i]['carpark_info'][0]['total_lots']
			var carpark_name = temp[i]['carpark_number'];
			// dps.push({label: carpark_name.toString(), y: parseInt(lots_avail,10)});
			// data.push(parseInt(lots_avail,10));
			myChart.config.data.datasets[0].data.push(parseInt(lots_avail,10));
			myChart.update();   
		}
	});

// console.log(dps);

}

</script>
</body>